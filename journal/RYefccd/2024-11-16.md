
# time-series

## kdb


> 不完全确定为什么它经常在 HN 上被崇拜。
我们已经用 Java 维护了 8 年的金融交易并实现了保证金结算，我向你保证，一旦我们能够将整个系统转移到 Java 上，那么无论是客户还是员工，每个人都会感到非常欣慰。
一旦你从量化办公桌场景转移开（每个人都同意，它非常了不起。相比之下，panda 和 dask 框架都感觉像幼儿园的玩具），可读性和可扩展性就会变得非常糟糕，灾难恢复选项基本上与分布式存储有关 - 顺便说一句，对于任何真正的 KDB 应用程序来说，这都“太慢了”，因为整个 KDB 概念在单个线程中将存储和计算结合在一起。而数据历史数据的用例，比如文章中提到的，很快就会变得非常糟糕：一个 kdb 进程一次处理一个请求，因此你最终不得不部署和维护数百个 RDB，将最后一小时的数据保存在内存中，HDB 保存实际的历史数据，每小时暂停一次数据写入，镜像树使用通过 TCP 的 IPC 将数据从匹配引擎复制到 RDB/HDB，重新执行作业以验证所有主机上的数据。更不用说这种具有单线程应用程序的 TCP-IPC 分发树意味着任何单个副本都会卡住（例如大查询，或者重启速度太慢）通常会导致完全锁定 - 一直到匹配引擎 - 所以你需要开始编写断路器逻辑来跳闸分发和查询（没有任何现成的功能）。然后在某个时候，你需要开始实现自定义分片机制，用于分发和查询（再次没有任何现成的功能..！）跨数百个进程和数十个服务器（这对断路器有影响），因为在数十个服务器上复制整个 KDB 数据集（以扩展你可以在合理的时间范围内实际提供的请求/秒）会变得非常昂贵。
>
这是 KX 顾问设计和推荐的架构，您最终必须聘请他们来“扩展”服务，以满足每天数十亿美元的杠杆交易需求。
>
现在，我们拥有的一切都是 Java 语言的 - 所有财务 / 数学逻辑都以 1:1 的比例移植，数据模式没有任何变化（无论是内部还是客户），使用 Disruptors、方便的 Chronicle / Aeron 队列，我们​​可以随时重播（恢复、认证、故障排除、回滚、基准测试等），以及用于历史记录的无限可扩展和分片的 s3 / trino / scylladb。性能提高了几个数量级（尽管花费了数千小时对 KDB 堆栈进行微优化 + 花费了数百万 KX 顾问的时间 - 而且实际上没有任何 Java 优化），事故在一夜之间基本不存在，工资单 + 基础设施账单也被一个非常有意义的因素划分了 :]

[kdb+ 的未来](https://www.timestored.com/b/the-future-of-kdb/)
[Is KDB a sane choice for a datalake in 2024?](https://news.ycombinator.com/item?id=40625800)

## [questdb](https://demo.questdb.io/)

[Benchmarking database performance with time series workloads](https://questdb.io/time-series-benchmark-suite/)
https://dev.to/questdb/how-we-achieved-write-speeds-of-1-4-million-rows-per-second-1a9l

| [questdb story](https://news.ycombinator.com/item?id=23975807)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 大家好，我是 Vlad，我与 Nic 和 Tanc 共同创立了 QuestDB ( [https://questdb.io](https://questdb.io/) )。QuestDB 是一个用于时间序列、事件和分析工作负载的开源数据库，主要关注性能 ( [https://github.com/questdb/questdb](https://github.com/questdb/questdb) )。<br><br>事情始于 2012 年，当时一家能源贸易公司聘请我重建他们的实时船舶跟踪系统。管理层希望我使用他们刚刚购买许可证的知名 XML 数据库。这个选项需要停产大约一周才能提取数据。而一周的停机时间根本不可行。由于没有更多资金可以花在软件上，我转向了 OpenTSDB 等替代方案，但它们不适合我们的数据模型。当时没有解决方案可以完成这个项目。<br><br>然后，我偶然发现了 Peter Lawrey 的 Java Chronicle 库 [1]。它使用内存映射文件在 2 分钟内加载了相同的数据，而不需要一周的时间。除了性能方面，我发现如此简单的方法可以同时解决多个问题，这真是令人着迷：快速写入，读取甚至可以在数据提交到磁盘之前进行，代码与内存交互而不是 IO 函数，没有要复制的缓冲区。顺便说一句，这是我第一次接触零 GC Java。<br><br>但存在几个问题。首先，当时看起来这个库不需要维护。其次，它使用 Java NIO 而不是直接使用 OS API。这增加了开销，因为它创建了单独的对象，其唯一目的是保存每个内存页的内存地址。第三，虽然 NIO 分配 API 有很好的文档记录，但释放 API 却没有。内存耗尽非常容易，而且很难管理内存页释放。我决定放弃 XML DB，然后开始用 Java 编写自定义存储引擎，类似于 Java Chronicle 所做的。该引擎使用内存映射文件、堆外内存和用于地理空间时间序列的自定义查询系统。实现这个是一次令人耳目一新的体验。我在几周内学到的东西比在工作中几年学到的还要多。<br><br>在我的整个职业生涯中，我主要在大型公司工作，这些公司通过以工单形式发送的逐项任务来“管理”开发人员。没有发挥创造力或主动性的空间。事实上，遵循工单上的确切指示才是最好的选择，即使它完全是胡说八道。我刚刚被提拔为管理职位，但一周后就后悔了。在花了这么长时间期盼升职之后，我立即想回到技术方面。我又开始痴迷于学习新东西，尤其是在高性能领域。<br><br>攒了一些钱之后，我辞去了工作，开始独自开发 QuestDB。我使用 Java 和一小层 C 直接与 OS API 交互，而无需通过选择器 API。虽然现有的 OS API 包装器更容易上手，但开销会增加复杂性并损害性能。我还希望系统完全没有 GC。为此，我必须自己构建堆外内存管理，而且不能使用现成的库。多年来，我不得不重写许多标准库，以避免产生任何垃圾。<br><br>因为我有了第一个孩子，所以在接下来的 6 年里，我不得不从事合同工来维持生计。我所学的一切增强了我的信心，我开始在面试中表现出色。这让我获得了薪水更高的合同，我可以少接一些工作，腾出更多的时间在 QuestDB 上工作，同时照顾我的家人。我会在白天做研究，晚上将其实现到 QuestDB 中。我一直在寻找下一个可以让性能更接近硬件极限的东西。<br><br>一年后，我意识到我最初的设计实际上是有缺陷的，必须抛弃它。它没有读者和写者分离的概念，因此会允许脏读。存储不能保证是连续的，页面的大小可能是各种不能被 64 位整除的。它对缓存也非常不友好，迫使使用缓慢的基于行的读取，而不是快速的列和矢量化读取。提交很慢，而且由于各个列文件可以独立提交，因此它们使数据容易受到损坏。<br><br>尽管这是一个挫折，但我还是重新开始工作。我编写了新引擎，以允许原子和持久的多列提交，提供可重复的读取隔离，并使提交即时完成。为此，我将事务文件与数据文件分开。这使得可以同时提交多个列作为最后提交的行 ID 的简单更新。我还通过删除重叠的内存页面并在页面边缘逐字节写入数据来提高存储密度。<br><br>这种新方法提高了查询性能。它使跨工作线程拆分数据和使用预取优化 CPU 管道变得容易。得益于 Agner Fog 的矢量类库 [3]，它解锁了基于列的执行和使用 SIMD 指令集 [2] 的额外虚拟并行性。它使我们有可能实现更新的创新，例如我们自己的 Google SwissTable 版本 [4]。几周前我们在 ShowHN [5] 上发布了一个演示服务器，我发布了更多细节。此演示仍可在线试用，预加载了 16 亿行的数据集 [6]。尽管一开始很难而且令人沮丧，但这次重写最终成为 QuestDB 发生的第二件好事。<br><br>最好的事情是人们开始为这个项目做出贡献。Tanc 和 Nic 离开我们之前的雇主来创建 QuestDB，我感到非常荣幸。几个月后，我的前同事离开了他们在银行的稳定低延迟工作，加入了我们。我认为这是一项巨大的责任，我不想让这些人失望。未来的工作量让我头疼不已，同时也让我起鸡皮疙瘩。<br><br>QuestDB 已投入生产，包括一家大型金融科技公司。我们一直致力于建立一个社区来吸引我们的第一批用户并收集尽可能多的反馈。<br><br>感谢您阅读这个故事 - 希望它很有趣。我很乐意阅读您对 QuestDB 的反馈并回答您的问题。 |

[表和列的自动创建](https://py-questdb-client.readthedocs.io/en/latest/sender.html#table-and-column-auto-creation)
https://questdb.io/docs/guides/enterprise-quick-start/#4-ingest-data-influxdb-line-protocol
https://py-questdb-client.readthedocs.io/en/latest/sender.html#table-and-column-names
https://questdb.io/docs/clients/ingest-python/
https://questdb.io/docs/reference/sql/alter-table-add-column/
https://github.com/questdb/py-questdb-query


questdb vs clickhouse
https://github.com/ClickHouse/ClickHouse/issues/38109


https://risingwave.com/blog/performance-and-scalability-of-influxdb-timescaledb-and-questdb/

https://www.reddit.com/r/algotrading/comments/1dquw93/should_i_use_timescaledb_influxdb_or_questdb_as_a/



https://dm13450.github.io/2021/08/05/questdb-part-1.html
https://dm13450.github.io/2022/02/02/Order-Flow-Imbalance.html
https://www.youtube.com/watch?v=9feAW2tNNYA
## clickhouse

https://engineeringat.axis.com/schema-changes-clickhouse/

## atlas


https://netflix.github.io/atlas-docs/asl/tutorial/
https://oss.oetiker.ch/rrdtool/doc/rrdgraph_rpn.en.html


## ArcticDB

https://github.com/man-group/ArcticDB

https://arcticdb.io/

https://docs.arcticdb.io/latest/



## 金融风控

https://chengzhaoxi.xyz/6f47625b.html

[反欺诈特征规则大放送](https://zhuanlan.zhihu.com/p/78682608)

[风控模型上线部署流程](https://zhuanlan.zhihu.com/p/92691256)